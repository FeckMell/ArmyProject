#include "stdafx.h"
#include "ValStoreTree.h"

using namespace std;
typedef ValStoreTree VST;
typedef ValStoreTreeEntry VSTE;

string VST::PrintAll()
{
	unsigned lvl_ = 0;
	string result = "";
	for ( auto& e : thatDataTree ) result += e.first + "=" + e.second.PrintAll(lvl_) + "\n";
	return result;
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
string VST::Val(string name_)
{
	if ( name_ == "" ) return "";
	unsigned lvl = 0;
	vector<string> name = STR::StrToVec(name_, ".");

	auto it = thatDataTree.find(name[lvl]);
	if ( it == thatDataTree.end() )	return "";
	else return it->second.Val(name, lvl);
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
void VST::SetVal(string name_, string val_)
{
	if ( name_ == "" ) return ;
	unsigned lvl = 0;
	vector<string> name = STR::StrToVec(name_, ".");

	auto it = thatDataTree.find(name[lvl]);
	if ( it == thatDataTree.end() )
	{
		thatDataTree.insert({ name[lvl], VSTE(name[lvl]) });
		thatDataTree[name[lvl]].SetVal(name, lvl, val_);
	}
	else it->second.SetVal(name, lvl, val_);
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
void VST::DelVal(string name_)
{
	if ( name_ == "" ) return ;
	unsigned lvl = 0;
	vector<string> name = STR::StrToVec(name_, ".");

	auto it = thatDataTree.find(name[lvl]);
	if ( it == thatDataTree.end() )	return ;
	else it->second.DelVal(name, lvl);
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
VST VST::ValSubTree(string name_)
{
	if ( name_ == "" ) return VST();
	unsigned lvl = 0;
	vector<string> name = STR::StrToVec(name_, ".");

	auto it = thatDataTree.find(name[lvl]);
	if ( it == thatDataTree.end() )	return VST();
	else
	{
		VSTE preresult = it->second.ValSubTree(name, lvl);
		if ( preresult.NodeName() == "" ) return VST();
		else
		{
			VST result;
			result.thatDataTree[preresult.NodeName()] = preresult;
			return result;
		}
	}
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
/* Not optimal in:*/
void VST::SetValSubTree(string name_, VST val_)
{
	if ( name_ == "" )
	{
		thatDataTree = val_.thatDataTree;
		return;
	}
	else
	{
		unsigned lvl = 0;
		vector<string> name = STR::StrToVec(name_, ".");

		auto it = thatDataTree.find(name[lvl]);
		if ( it == thatDataTree.end() )
		{
			thatDataTree.insert({ name[lvl], VSTE(name[lvl]) });
			for ( auto& e : val_.thatDataTree ) //HERE
			{
				thatDataTree[name[lvl]].SetValSubTree(name, lvl, e.second);
			}
		}
		else
		{
			for ( auto& e : val_.thatDataTree )//AND HERE
			{
				it->second.SetValSubTree(name, lvl, e.second);
			}
		}
	}
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
void VST::DelValSubTree(string name_)
{
	if ( name_ == "" )
	{
		thatDataTree = map<string, VSTE>();
		return;
	}
	unsigned lvl = 0;
	vector<string> name = STR::StrToVec(name_, ".");

	auto it = thatDataTree.find(name[lvl]);
	if ( it == thatDataTree.end() ) return;
	else
	{
		if ( name.size() == 1 ) thatDataTree.erase(it);
		else it->second.DelValSubTree(name, lvl);
	}
}
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------
//*///------------------------------------------------------------------------------------------